<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>reMarkable Pro Template</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls label {
            margin-right: 15px;
            font-weight: bold;
        }
        
        .controls select, .controls button {
            padding: 8px 12px;
            margin-right: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        
        .controls button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .template-container {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 0 auto;
        }
        
        .template-page {
            width: 1872px;
            height: 1404px;
            background: #f5f5f5;
            position: relative;
            margin: 0 auto;
        }
        
        .border-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
        }
        
        .content-area {
            position: absolute;
            background: white;
            z-index: 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .margin-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 2;
        }
        
        .url-text {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #999;
            font-family: Arial, sans-serif;
            z-index: 3;
            pointer-events: none;
        }
        
        .lined {
            background-color: white;
        }
        
        .grid {
            background-color: white;
        }
        
        .dot-grid {
            background-color: white;
        }
        
        .blank {
            background: white;
        }
        
        .cornell {
            background: white;
            position: relative;
        }
        
        .cornell::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 150px;
            width: 30%;
            border-right: 2px solid #c0c0c0;
        }
        
        .cornell::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: 150px;
            height: 2px;
            background: #c0c0c0;
        }
        
        .music {
            background-image: repeating-linear-gradient(
                transparent,
                transparent 100px,
                #d0d0d0 100px,
                #d0d0d0 101px,
                transparent 101px,
                transparent 120px,
                #d0d0d0 120px,
                #d0d0d0 121px,
                transparent 121px,
                transparent 140px,
                #d0d0d0 140px,
                #d0d0d0 141px,
                transparent 141px,
                transparent 160px,
                #d0d0d0 160px,
                #d0d0d0 161px,
                transparent 161px,
                transparent 180px,
                #d0d0d0 180px,
                #d0d0d0 181px,
                transparent 181px,
                transparent 250px
            );
        }
        
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .controls {
                display: none;
            }
            
            .info {
                display: none;
            }
            
            .template-container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            
            .template-page {
                page-break-after: always;
                margin: 0;
            }
            
            .content-area {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }
        
        .info {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h2 style="margin: 0 0 5px 0; color: #333; text-align: center; font-style: italic; font-weight: normal;">Rives' reMarkable Book Publishing Template</h2>
        <p style="margin: 0 0 15px 0; color: #666; text-align: center; font-size: 14px;">Suitable for writing on the reMarkable</p>
        
        <div style="margin-bottom: 10px;">
            <label for="deviceType">Device:</label>
            <select id="deviceType">
                <option value="rm2">reMarkable 1/2</option>
                <option value="rmpro" selected>reMarkable Pro</option>
                <option value="paperpromove">Paper Pro Move</option>
            </select>
            
            <label for="pageSize" style="margin-left: 20px;">Page Size:</label>
            <select id="pageSize">
                <option value="1872,1404">Full reMarkable Pro (8.27" × 6.20")</option>
            </select>
        </div>
        
        <div style="margin-bottom: 10px;">
            <label for="bindingType">Binding Type:</label>
            <select id="bindingType">
                <option value="perfect">Perfect Binding (Glued)</option>
                <option value="saddle">Saddle Stitch (Stapled)</option>
                <option value="spiral">Spiral/Coil Binding</option>
                <option value="wireo">Wire-O Binding</option>
                <option value="case">Case Binding (Hardcover)</option>
            </select>
            
            <label for="platform" style="margin-left: 20px;">Platform:</label>
            <select id="platform">
                <option value="general">General Publishing</option>
                <option value="kdp">Amazon KDP</option>
                <option value="ingram">IngramSpark</option>
                <option value="lulu">Lulu</option>
                <option value="bn">Barnes & Noble Press</option>
                <option value="d2d">Draft2Digital</option>
                <option value="blurb">Blurb</option>
                <option value="bookbaby">BookBaby</option>
            </select>
            
            <button onclick="applyRecommendedMargins()" style="margin-left: 20px; padding: 8px 12px; border-radius: 4px; border: 1px solid #ccc; background: #28a745; color: white; cursor: pointer;">Apply Margin Recommendations</button>
        </div>
        
        <div id="marginRecommendation" style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-left: 4px solid #28a745; border-radius: 4px; font-size: 13px; display: none;">
            <strong>Recommended Margins:</strong> <span id="recommendationText"></span>
        </div>
        
        <div style="margin-bottom: 10px;">
            <label for="marginTop">Margins - Top:</label>
            <select id="marginTop">
                <option value="0">0"</option>
                <option value="11.3">0.05"</option>
                <option value="22.6">0.10"</option>
                <option value="33.9">0.15"</option>
                <option value="45.2">0.20"</option>
                <option value="56.5">0.25"</option>
                <option value="67.8">0.30"</option>
                <option value="79.1">0.35"</option>
                <option value="90.4">0.40"</option>
                <option value="101.7">0.45"</option>
                <option value="113">0.50"</option>
                <option value="124.3">0.55"</option>
                <option value="135.6">0.60"</option>
                <option value="146.9">0.65"</option>
                <option value="158.2">0.70"</option>
                <option value="169.5" selected>0.75"</option>
                <option value="180.8">0.80"</option>
                <option value="192.1">0.85"</option>
                <option value="203.4">0.90"</option>
                <option value="214.7">0.95"</option>
                <option value="226">1.00"</option>
                <option value="237.3">1.05"</option>
                <option value="248.6">1.10"</option>
                <option value="259.9">1.15"</option>
                <option value="271.2">1.20"</option>
                <option value="282.5">1.25"</option>
                <option value="293.8">1.30"</option>
                <option value="305.1">1.35"</option>
                <option value="316.4">1.40"</option>
                <option value="327.7">1.45"</option>
                <option value="339">1.50"</option>
            </select>
            
            <label for="marginBottom" style="margin-left: 10px;">Bottom:</label>
            <select id="marginBottom">
                <option value="0">0"</option>
                <option value="11.3">0.05"</option>
                <option value="22.6">0.10"</option>
                <option value="33.9">0.15"</option>
                <option value="45.2">0.20"</option>
                <option value="56.5">0.25"</option>
                <option value="67.8">0.30"</option>
                <option value="79.1">0.35"</option>
                <option value="90.4">0.40"</option>
                <option value="101.7">0.45"</option>
                <option value="113">0.50"</option>
                <option value="124.3">0.55"</option>
                <option value="135.6">0.60"</option>
                <option value="146.9">0.65"</option>
                <option value="158.2">0.70"</option>
                <option value="169.5" selected>0.75"</option>
                <option value="180.8">0.80"</option>
                <option value="192.1">0.85"</option>
                <option value="203.4">0.90"</option>
                <option value="214.7">0.95"</option>
                <option value="226">1.00"</option>
                <option value="237.3">1.05"</option>
                <option value="248.6">1.10"</option>
                <option value="259.9">1.15"</option>
                <option value="271.2">1.20"</option>
                <option value="282.5">1.25"</option>
                <option value="293.8">1.30"</option>
                <option value="305.1">1.35"</option>
                <option value="316.4">1.40"</option>
                <option value="327.7">1.45"</option>
                <option value="339">1.50"</option>
            </select>
            
            <label for="marginLeft" style="margin-left: 10px;">Left:</label>
            <select id="marginLeft">
                <option value="0">0"</option>
                <option value="11.3">0.05"</option>
                <option value="22.6">0.10"</option>
                <option value="33.9">0.15"</option>
                <option value="45.2">0.20"</option>
                <option value="56.5">0.25"</option>
                <option value="67.8">0.30"</option>
                <option value="79.1">0.35"</option>
                <option value="90.4">0.40"</option>
                <option value="101.7">0.45"</option>
                <option value="113">0.50"</option>
                <option value="124.3">0.55"</option>
                <option value="135.6">0.60"</option>
                <option value="146.9">0.65"</option>
                <option value="158.2">0.70"</option>
                <option value="169.5" selected>0.75"</option>
                <option value="180.8">0.80"</option>
                <option value="192.1">0.85"</option>
                <option value="203.4">0.90"</option>
                <option value="214.7">0.95"</option>
                <option value="226">1.00"</option>
                <option value="237.3">1.05"</option>
                <option value="248.6">1.10"</option>
                <option value="259.9">1.15"</option>
                <option value="271.2">1.20"</option>
                <option value="282.5">1.25"</option>
                <option value="293.8">1.30"</option>
                <option value="305.1">1.35"</option>
                <option value="316.4">1.40"</option>
                <option value="327.7">1.45"</option>
                <option value="339">1.50"</option>
            </select>
            
            <label for="marginRight" style="margin-left: 10px;">Right:</label>
            <select id="marginRight">
                <option value="0">0"</option>
                <option value="11.3">0.05"</option>
                <option value="22.6">0.10"</option>
                <option value="33.9">0.15"</option>
                <option value="45.2">0.20"</option>
                <option value="56.5">0.25"</option>
                <option value="67.8">0.30"</option>
                <option value="79.1">0.35"</option>
                <option value="90.4">0.40"</option>
                <option value="101.7">0.45"</option>
                <option value="113">0.50"</option>
                <option value="124.3">0.55"</option>
                <option value="135.6">0.60"</option>
                <option value="146.9">0.65"</option>
                <option value="158.2">0.70"</option>
                <option value="169.5" selected>0.75"</option>
                <option value="180.8">0.80"</option>
                <option value="192.1">0.85"</option>
                <option value="203.4">0.90"</option>
                <option value="214.7">0.95"</option>
                <option value="226">1.00"</option>
                <option value="237.3">1.05"</option>
                <option value="248.6">1.10"</option>
                <option value="259.9">1.15"</option>
                <option value="271.2">1.20"</option>
                <option value="282.5">1.25"</option>
                <option value="293.8">1.30"</option>
                <option value="305.1">1.35"</option>
                <option value="316.4">1.40"</option>
                <option value="327.7">1.45"</option>
                <option value="339">1.50"</option>
            </select>
        </div>
        
        <div>
            <label for="templateType">Template Type:</label>
            <select id="templateType">
                <option value="blank">Blank</option>
                <option value="lined">Lined</option>
                <option value="grid" selected>Grid</option>
                <option value="dot-grid">Dot Grid</option>
                <option value="cornell">Cornell Notes</option>
                <option value="music">Music Staff</option>
            </select>
            
            <label for="gridSize" id="gridSizeLabel" style="margin-left: 20px;">Line/Grid Size:</label>
            <select id="gridSize">
                <option value="11.3">0.05" (11px)</option>
                <option value="22.6" selected>0.10" (23px)</option>
                <option value="33.9">0.15" (34px)</option>
                <option value="45.2">0.20" (45px)</option>
                <option value="56.5">0.25" (57px)</option>
                <option value="67.8">0.30" (68px)</option>
                <option value="79.1">0.35" (79px)</option>
                <option value="90.4">0.40" (90px)</option>
                <option value="101.7">0.45" (102px)</option>
                <option value="113">0.50" (113px)</option>
                <option value="124.3">0.55" (124px)</option>
                <option value="135.6">0.60" (136px)</option>
                <option value="146.9">0.65" (147px)</option>
                <option value="158.2">0.70" (158px)</option>
                <option value="169.5">0.75" (170px)</option>
                <option value="180.8">0.80" (181px)</option>
                <option value="192.1">0.85" (192px)</option>
                <option value="203.4">0.90" (203px)</option>
                <option value="214.7">0.95" (215px)</option>
                <option value="226">1.00" (226px)</option>
                <option value="237.3">1.05" (237px)</option>
                <option value="248.6">1.10" (249px)</option>
                <option value="259.9">1.15" (260px)</option>
                <option value="271.2">1.20" (271px)</option>
                <option value="282.5">1.25" (283px)</option>
            </select>
            
            <label for="overlayGrid" id="overlayGridLabel" style="margin-left: 20px;">Overlay Every:</label>
            <select id="overlayGrid">
                <option value="0">None</option>
                <option value="2">2 squares</option>
                <option value="3">3 squares</option>
                <option value="4">4 squares</option>
                <option value="5" selected>5 squares</option>
                <option value="6">6 squares</option>
                <option value="7">7 squares</option>
                <option value="8">8 squares</option>
                <option value="9">9 squares</option>
                <option value="10">10 squares</option>
            </select>
            
            <button onclick="printTemplate()">Print/Save as PDF</button>
        </div>
    </div>
    
    <div class="info">
        <strong>Instructions:</strong> 
        <ul style="margin: 10px 0; padding-left: 20px;">
            <li><strong>Device:</strong> Select your reMarkable device. This adjusts the canvas size and available page sizes.</li>
            <li><strong>Page Size:</strong> Select your target book/page size. Default publishing margins are automatically applied.</li>
            <li><strong>Binding Type & Platform:</strong> View margin recommendations for different binding types and publishing platforms. Click "Apply Recommended Margins" to use suggested defaults.</li>
            <li><strong>Margins:</strong> Adjust individual margins for top, bottom, left, and right (0" to 1.5" in 0.05" increments). Margins are shown with borders (gray for reMarkable 1/2, red for color devices).</li>
            <li><strong>Template Type:</strong> Select your preferred template style (lined, grid, dot grid, etc.).</li>
            <li><strong>Line/Grid Size:</strong> For lined, grid, or dot-grid templates, choose the spacing in inches (0.05" to 1.25").</li>
            <li><strong>Overlay Every:</strong> For grid/dot-grid templates, add darker lines/dots every N squares for major/minor grid divisions.</li>
            <li><strong>Export:</strong> Click "Print/Save as PDF" and select "Save as PDF" in the dialog.</li>
        </ul>
        Transfer the PDF to your reMarkable device via the mobile app or desktop software.
    </div>
    
    <div class="template-container">
        <div id="templatePage" class="template-page">
            <div id="borderOverlay" class="border-overlay"></div>
            <div id="contentArea" class="content-area grid">
                <div id="urlText" class="url-text">https://srives.github.io/reMarkable/</div>
                <div id="marginLines" class="margin-lines"></div>
            </div>
        </div>
    </div>
    
    <script>
        const deviceTypeSelect = document.getElementById('deviceType');
        const templateTypeSelect = document.getElementById('templateType');
        const pageSizeSelect = document.getElementById('pageSize');
        const bindingTypeSelect = document.getElementById('bindingType');
        const platformSelect = document.getElementById('platform');
        const marginTopSelect = document.getElementById('marginTop');
        const marginBottomSelect = document.getElementById('marginBottom');
        const marginLeftSelect = document.getElementById('marginLeft');
        const marginRightSelect = document.getElementById('marginRight');
        const gridSizeSelect = document.getElementById('gridSize');
        const overlayGridSelect = document.getElementById('overlayGrid');
        const gridSizeLabel = document.getElementById('gridSizeLabel');
        const overlayGridLabel = document.getElementById('overlayGridLabel');
        const contentArea = document.getElementById('contentArea');
        const borderOverlay = document.getElementById('borderOverlay');
        const marginLines = document.getElementById('marginLines');
        const templatePage = document.getElementById('templatePage');
        const urlText = document.getElementById('urlText');
        const marginRecommendation = document.getElementById('marginRecommendation');
        const recommendationText = document.getElementById('recommendationText');
        
        const devices = {
            rm2: {
                name: 'reMarkable 1/2',
                width: 1872,
                height: 1404,
                dpi: 226,
                sizes: [
                    { value: '1872,1404', label: 'Full reMarkable 1/2 (8.27" × 6.20")' },
                    // Mass Market
                    { value: '961,1553', label: 'Mass Market / Pocket Book Portrait (4.25" × 6.87")' },
                    { value: '1553,961', label: 'Mass Market / Pocket Book Landscape (6.87" × 4.25")' },
                    // Fiction & Novellas
                    { value: '1130,1808', label: 'Fiction / Novella Portrait (5" × 8")' },
                    { value: '1808,1130', label: 'Fiction / Novella Landscape (8" × 5")' },
                    { value: '1186,1808', label: 'Fiction Portrait (5.25" × 8")' },
                    { value: '1808,1186', label: 'Fiction Landscape (8" × 5.25")' },
                    { value: '1243,1921', label: 'Digest Portrait (5.5" × 8.5")' },
                    { value: '1921,1243', label: 'Digest Landscape (8.5" × 5.5")' },
                    { value: '1356,2034', label: 'US Trade Portrait (6" × 9")' },
                    { value: '2034,1356', label: 'US Trade Landscape (9" × 6")' },
                    // A-Series
                    { value: '1317,1869', label: 'A5 Portrait (5.83" × 8.27")' },
                    { value: '1869,1317', label: 'A5 Landscape (8.27" × 5.83")' },
                    { value: '933,1317', label: 'A6 Portrait (4.13" × 5.83")' },
                    { value: '1317,933', label: 'A6 Landscape (5.83" × 4.13")' },
                    // UK B-Format
                    { value: '1146,1763', label: 'UK B-Format Portrait (5.07" × 7.8")' },
                    { value: '1763,1146', label: 'UK B-Format Landscape (7.8" × 5.07")' },
                    // Royal
                    { value: '1388,2081', label: 'Royal Portrait (6.14" × 9.21")' },
                    // Non-Fiction & Children's
                    { value: '1582,2260', label: 'Non-Fiction / Children\'s Portrait (7" × 10")' },
                    { value: '1808,2260', label: 'Large Format Portrait (8" × 10")' },
                    { value: '1921,2486', label: 'Textbook / Manual Portrait (8.5" × 11")' },
                    // Square formats
                    { value: '1582,1582', label: 'Square Small (7" × 7")' },
                    { value: '1808,1808', label: 'Square Medium (8" × 8")' },
                    { value: '1921,1921', label: 'Square Large (8.5" × 8.5")' }
                ]
            },
            rmpro: {
                name: 'reMarkable Pro',
                width: 1872,
                height: 1404,
                dpi: 226,
                sizes: [
                    { value: '1872,1404', label: 'Full reMarkable Pro (8.27" × 6.20")' },
                    // Mass Market
                    { value: '961,1553', label: 'Mass Market / Pocket Book Portrait (4.25" × 6.87")' },
                    { value: '1553,961', label: 'Mass Market / Pocket Book Landscape (6.87" × 4.25")' },
                    // Fiction & Novellas
                    { value: '1130,1808', label: 'Fiction / Novella Portrait (5" × 8")' },
                    { value: '1808,1130', label: 'Fiction / Novella Landscape (8" × 5")' },
                    { value: '1186,1808', label: 'Fiction Portrait (5.25" × 8")' },
                    { value: '1808,1186', label: 'Fiction Landscape (8" × 5.25")' },
                    { value: '1243,1921', label: 'Digest Portrait (5.5" × 8.5")' },
                    { value: '1921,1243', label: 'Digest Landscape (8.5" × 5.5")' },
                    { value: '1356,2034', label: 'US Trade Portrait (6" × 9")' },
                    { value: '2034,1356', label: 'US Trade Landscape (9" × 6")' },
                    // A-Series
                    { value: '1317,1869', label: 'A5 Portrait (5.83" × 8.27")' },
                    { value: '1869,1317', label: 'A5 Landscape (8.27" × 5.83")' },
                    { value: '933,1317', label: 'A6 Portrait (4.13" × 5.83")' },
                    { value: '1317,933', label: 'A6 Landscape (5.83" × 4.13")' },
                    // UK B-Format
                    { value: '1146,1763', label: 'UK B-Format Portrait (5.07" × 7.8")' },
                    { value: '1763,1146', label: 'UK B-Format Landscape (7.8" × 5.07")' },
                    // Royal
                    { value: '1388,2081', label: 'Royal Portrait (6.14" × 9.21")' },
                    // Non-Fiction & Children's
                    { value: '1582,2260', label: 'Non-Fiction / Children\'s Portrait (7" × 10")' },
                    { value: '1808,2260', label: 'Large Format Portrait (8" × 10")' },
                    { value: '1921,2486', label: 'Textbook / Manual Portrait (8.5" × 11")' },
                    // Square formats
                    { value: '1582,1582', label: 'Square Small (7" × 7")' },
                    { value: '1808,1808', label: 'Square Medium (8" × 8")' },
                    { value: '1921,1921', label: 'Square Large (8.5" × 8.5")' }
                ]
            },
            paperpromove: {
                name: 'Paper Pro Move',
                width: 1696,
                height: 954,
                dpi: 264,
                sizes: [
                    { value: '1696,954', label: 'Full Paper Pro Move (6.42" × 3.61")' },
                    // Compact sizes that fit
                    { value: '1122,1814', label: 'Mass Market Portrait (4.25" × 6.87")' },
                    { value: '1320,2112', label: 'Fiction Portrait (5" × 8")' },
                    { value: '1386,2112', label: 'Fiction Portrait (5.25" × 8")' },
                    { value: '1452,2244', label: 'Digest Portrait (5.5" × 8.5")' },
                    { value: '1584,2376', label: 'US Trade Portrait (6" × 9")' },
                    // A-Series
                    { value: '1540,2185', label: 'A5 Portrait (5.83" × 8.27")' },
                    { value: '1090,1540', label: 'A6 Portrait (4.13" × 5.83")' },
                    { value: '1540,1090', label: 'A6 Landscape (5.83" × 4.13")' },
                    // UK Format
                    { value: '1339,2059', label: 'UK B-Format Portrait (5.07" × 7.8")' },
                    // Compact formats
                    { value: '1056,792', label: 'Mini Landscape (4" × 3")' },
                    { value: '1320,1056', label: 'Compact Portrait (5" × 4")' }
                ]
            }
        };
        
        const defaultMargins = {
            // Full device sizes
            '1872,1404': { top: 135.6, bottom: 146.9, left: 135.6, right: 135.6 },
            '1696,954': { top: 79.2, bottom: 92.4, left: 92.4, right: 79.2 },
            
            // Mass Market / Pocket Book (4.25" × 6.87")
            '961,1553': { top: 90.4, bottom: 101.7, left: 90.4, right: 90.4 },
            '1553,961': { top: 67.8, bottom: 79.1, left: 90.4, right: 79.1 },
            '1122,1814': { top: 92.4, bottom: 105.6, left: 92.4, right: 92.4 },
            
            // Fiction / Novella (5" × 8")
            '1130,1808': { top: 101.7, bottom: 113, left: 101.7, right: 90.4 },
            '1808,1130': { top: 79.1, bottom: 90.4, left: 113, right: 90.4 },
            '1320,2112': { top: 105.6, bottom: 118.8, left: 105.6, right: 92.4 },
            
            // Fiction (5.25" × 8")
            '1186,1808': { top: 101.7, bottom: 113, left: 101.7, right: 90.4 },
            '1808,1186': { top: 79.1, bottom: 90.4, left: 113, right: 90.4 },
            '1386,2112': { top: 105.6, bottom: 118.8, left: 105.6, right: 92.4 },
            
            // Digest (5.5" × 8.5")
            '1243,1921': { top: 113, bottom: 124.3, left: 113, right: 101.7 },
            '1921,1243': { top: 90.4, bottom: 101.7, left: 124.3, right: 101.7 },
            '1452,2244': { top: 118.8, bottom: 132, left: 118.8, right: 105.6 },
            
            // US Trade (6" × 9")
            '1356,2034': { top: 124.3, bottom: 135.6, left: 124.3, right: 113 },
            '2034,1356': { top: 101.7, bottom: 113, left: 135.6, right: 113 },
            '1584,2376': { top: 132, bottom: 145.2, left: 132, right: 118.8 },
            
            // A5 (5.83" × 8.27")
            '1317,1869': { top: 124.3, bottom: 135.6, left: 113, right: 113 },
            '1869,1317': { top: 113, bottom: 124.3, left: 135.6, right: 113 },
            '1540,2185': { top: 132, bottom: 145.2, left: 118.8, right: 118.8 },
            
            // A6 (4.13" × 5.83")
            '933,1317': { top: 90.4, bottom: 101.7, left: 90.4, right: 79.1 },
            '1317,933': { top: 79.1, bottom: 90.4, left: 101.7, right: 79.1 },
            '1090,1540': { top: 92.4, bottom: 105.6, left: 92.4, right: 79.2 },
            '1540,1090': { top: 79.2, bottom: 92.4, left: 105.6, right: 79.2 },
            
            // UK B-Format (5.07" × 7.8")
            '1146,1763': { top: 101.7, bottom: 113, left: 101.7, right: 90.4 },
            '1763,1146': { top: 79.1, bottom: 90.4, left: 113, right: 90.4 },
            '1339,2059': { top: 105.6, bottom: 118.8, left: 105.6, right: 92.4 },
            
            // Royal (6.14" × 9.21")
            '1388,2081': { top: 124.3, bottom: 135.6, left: 124.3, right: 113 },
            
            // Non-Fiction / Children's (7" × 10")
            '1582,2260': { top: 135.6, bottom: 146.9, left: 135.6, right: 124.3 },
            
            // Large Format (8" × 10")
            '1808,2260': { top: 135.6, bottom: 146.9, left: 146.9, right: 135.6 },
            
            // Textbook / Manual (8.5" × 11")
            '1921,2486': { top: 146.9, bottom: 158.2, left: 146.9, right: 135.6 },
            
            // Square formats
            '1582,1582': { top: 113, bottom: 124.3, left: 113, right: 113 },
            '1808,1808': { top: 124.3, bottom: 135.6, left: 124.3, right: 124.3 },
            '1921,1921': { top: 135.6, bottom: 146.9, left: 135.6, right: 135.6 },
            
            // Paper Pro Move compact formats
            '1056,792': { top: 66, bottom: 79.2, left: 66, right: 66 },
            '1320,1056': { top: 79.2, bottom: 92.4, left: 79.2, right: 66 }
        };
        
        const marginRecommendations = {
            binding: {
                perfect: {
                    name: "Perfect Binding",
                    desc: "Inner/gutter margin should be 0.625\"-0.75\" to account for spine curve. Top: 0.5\"-0.625\", Bottom: 0.625\"-0.75\" (larger than top), Outer: 0.5\"-0.625\"."
                },
                saddle: {
                    name: "Saddle Stitch",
                    desc: "Can use smaller, more equal margins since pages lie flatter. All margins: 0.375\"-0.5\". Inner margin can be slightly smaller than perfect binding."
                },
                spiral: {
                    name: "Spiral/Coil Binding",
                    desc: "Inner margin needs 0.5\"-0.75\" for binding holes. Other margins: 0.375\"-0.5\". Pages lie completely flat."
                },
                wireo: {
                    name: "Wire-O Binding",
                    desc: "Similar to spiral. Inner margin: 0.5\"-0.75\" for wire. Other margins: 0.375\"-0.5\". Pages lay flat and can flip 360°."
                },
                case: {
                    name: "Case Binding (Hardcover)",
                    desc: "More generous margins due to rigid cover. Inner/gutter: 0.75\"-1\", Top: 0.625\"-0.75\", Bottom: 0.75\"-0.875\", Outer: 0.625\"-0.75\"."
                }
            },
            platform: {
                general: {
                    name: "General Publishing",
                    desc: "Standard industry practice: Inner 0.625\"-0.75\", Top 0.5\"-0.625\", Bottom 0.625\"-0.75\", Outer 0.5\"-0.625\". Bottom margin typically largest."
                },
                kdp: {
                    name: "Amazon KDP",
                    desc: "Minimum 0.25\" all sides, but 0.375\"-0.5\" recommended. For books under 150 pages: 0.375\" minimum. 150-400 pages: 0.5\" minimum. Over 400 pages: 0.625\" minimum inner margin."
                },
                ingram: {
                    name: "IngramSpark",
                    desc: "Minimum 0.5\" inside margin required. Recommends: Inside 0.625\"-0.75\", Outside 0.5\", Top 0.5\", Bottom 0.625\". Add 0.125\" per 100 pages for spine thickness."
                },
                lulu: {
                    name: "Lulu",
                    desc: "Minimum 0.25\" all sides. Recommended: Inside 0.625\", Outside 0.5\", Top 0.5\", Bottom 0.625\". For perfect binding, suggest 0.75\" inside margin."
                },
                bn: {
                    name: "Barnes & Noble Press",
                    desc: "Minimum 0.375\" all sides. Recommended: Inside 0.5\"-0.625\", Outside 0.5\", Top 0.5\", Bottom 0.625\". Add more for larger page counts."
                },
                d2d: {
                    name: "Draft2Digital",
                    desc: "Works with multiple print partners. Safe margins: Inside 0.625\", Outside 0.5\", Top 0.5\", Bottom 0.625\". Follows KDP guidelines generally."
                },
                blurb: {
                    name: "Blurb",
                    desc: "Varies by book type. Standard: 0.5\" minimum all sides. Trade books: Inside 0.625\", Outside 0.5\", Top 0.5\", Bottom 0.625\". Photo books can be smaller."
                },
                bookbaby: {
                    name: "BookBaby",
                    desc: "Minimum 0.5\" all sides recommended. Professional standard: Inside 0.75\", Outside 0.5\", Top 0.625\", Bottom 0.75\". More generous for premium appearance."
                }
            }
        };
        
        function updateRecommendation() {
            const binding = marginRecommendations.binding[bindingTypeSelect.value];
            const platform = marginRecommendations.platform[platformSelect.value];
            
            recommendationText.innerHTML = `
                <div style="margin-bottom: 8px;"><strong>${binding.name}:</strong> ${binding.desc}</div>
                <div><strong>${platform.name}:</strong> ${platform.desc}</div>
            `;
            marginRecommendation.style.display = 'block';
        }
        
        function applyRecommendedMargins() {
            const pageSize = pageSizeSelect.value;
            const margins = defaultMargins[pageSize];
            
            if (margins) {
                marginTopSelect.value = margins.top;
                marginBottomSelect.value = margins.bottom;
                marginLeftSelect.value = margins.left;
                marginRightSelect.value = margins.right;
                updateTemplate();
            }
        }
        
        window.applyRecommendedMargins = applyRecommendedMargins;
        
        function applyDefaultMargins() {
            const pageSize = pageSizeSelect.value;
            const margins = defaultMargins[pageSize];
            
            if (margins) {
                marginTopSelect.value = margins.top;
                marginBottomSelect.value = margins.bottom;
                marginLeftSelect.value = margins.left;
                marginRightSelect.value = margins.right;
            }
        }
        
        function updatePageSizes() {
            const device = devices[deviceTypeSelect.value];
            const currentValue = pageSizeSelect.value;
            
            templatePage.style.width = device.width + 'px';
            templatePage.style.height = device.height + 'px';
            
            // Update print page size dynamically
            updatePrintPageSize(device.width, device.height);
            
            pageSizeSelect.innerHTML = '';
            device.sizes.forEach(size => {
                const [width, height] = size.value.split(',').map(Number);
                const option = document.createElement('option');
                option.value = size.value;
                
                // Check if size exceeds device dimensions
                if (width > device.width || height > device.height) {
                    option.textContent = size.label + ' (Too Large)';
                    option.disabled = true;
                    option.style.color = '#999';
                } else {
                    option.textContent = size.label;
                }
                
                pageSizeSelect.appendChild(option);
            });
            
            // Try to maintain similar selection or default to first non-disabled
            const sameIndex = device.sizes.findIndex(s => s.value === currentValue);
            if (sameIndex >= 0) {
                const [width, height] = currentValue.split(',').map(Number);
                if (width <= device.width && height <= device.height) {
                    pageSizeSelect.selectedIndex = sameIndex;
                } else {
                    // Select first non-disabled option
                    pageSizeSelect.selectedIndex = 0;
                }
            } else {
                pageSizeSelect.selectedIndex = 0;
            }
            
            applyDefaultMargins();
            updateTemplate();
        }
        
        function updatePrintPageSize(width, height) {
            // Remove existing print style if it exists
            const existingStyle = document.getElementById('dynamic-print-style');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Create new style element for print page size
            const style = document.createElement('style');
            style.id = 'dynamic-print-style';
            style.textContent = `
                @media print {
                    @page {
                        size: ${width}px ${height}px;
                        margin: 0;
                    }
                    body {
                        width: ${width}px;
                        height: ${height}px;
                    }
                    .template-page {
                        width: ${width}px !important;
                        height: ${height}px !important;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        function printTemplate() {
            // Get the selected page size label for the filename
            const selectedOption = pageSizeSelect.options[pageSizeSelect.selectedIndex];
            const pageLabel = selectedOption.textContent.trim();
            
            // Clean up the label to make it filename-friendly
            const filename = pageLabel
                .replace(/[^\w\s\-\(\)\.]/g, '') // Remove special chars except spaces, hyphens, parens, dots
                .replace(/\s+/g, '_')             // Replace spaces with underscores
                .replace(/_{2,}/g, '_');          // Replace multiple underscores with single
            
            // Set document title (browsers use this as default filename)
            const originalTitle = document.title;
            document.title = filename;
            
            // Print
            window.print();
            
            // Restore original title after a delay
            setTimeout(() => {
                document.title = originalTitle;
            }, 1000);
        }
        
        window.printTemplate = printTemplate;
        
        function updateTemplate() {
            const device = devices[deviceTypeSelect.value];
            const [pageWidth, pageHeight] = pageSizeSelect.value.split(',').map(Number);
            const marginTop = parseFloat(marginTopSelect.value);
            const marginBottom = parseFloat(marginBottomSelect.value);
            const marginLeft = parseFloat(marginLeftSelect.value);
            const marginRight = parseFloat(marginRightSelect.value);
            const gridSize = parseFloat(gridSizeSelect.value);
            const overlayMultiplier = parseInt(overlayGridSelect.value);
            const templateType = templateTypeSelect.value;
            
            const offsetX = (device.width - pageWidth) / 2;
            const offsetY = (device.height - pageHeight) / 2;
            
            contentArea.style.width = pageWidth + 'px';
            contentArea.style.height = pageHeight + 'px';
            contentArea.style.left = offsetX + 'px';
            contentArea.style.top = offsetY + 'px';
            
            if (offsetX > 0 || offsetY > 0) {
                borderOverlay.style.boxShadow = `
                    inset ${offsetX}px 0 0 rgba(0,0,0,0.15),
                    inset -${offsetX}px 0 0 rgba(0,0,0,0.15),
                    inset 0 ${offsetY}px 0 rgba(0,0,0,0.15),
                    inset 0 -${offsetY}px 0 rgba(0,0,0,0.15)
                `;
            } else {
                borderOverlay.style.boxShadow = 'none';
            }
            
            contentArea.className = 'content-area ' + templateType;
            
            if (templateType === 'lined' || templateType === 'grid' || templateType === 'dot-grid') {
                gridSizeSelect.style.display = 'inline-block';
                gridSizeLabel.style.display = 'inline';
            } else {
                gridSizeSelect.style.display = 'none';
                gridSizeLabel.style.display = 'none';
            }
            
            if (templateType === 'grid' || templateType === 'dot-grid') {
                overlayGridSelect.style.display = 'inline-block';
                overlayGridLabel.style.display = 'inline';
            } else {
                overlayGridSelect.style.display = 'none';
                overlayGridLabel.style.display = 'none';
            }
            
            if (templateType === 'lined') {
                const lineSpacing = gridSize - 1;
                contentArea.style.backgroundImage = `
                    repeating-linear-gradient(
                        transparent,
                        transparent ${lineSpacing}px,
                        #d0d0d0 ${lineSpacing}px,
                        #d0d0d0 ${gridSize}px
                    )
                `;
                contentArea.style.backgroundSize = '';
            } else if (templateType === 'grid') {
                const overlaySize = gridSize * overlayMultiplier;
                let backgroundImages = `
                    repeating-linear-gradient(0deg, #e0e0e0 0px, #e0e0e0 1px, transparent 1px, transparent ${gridSize}px),
                    repeating-linear-gradient(90deg, #e0e0e0 0px, #e0e0e0 1px, transparent 1px, transparent ${gridSize}px)
                `;
                
                if (overlayMultiplier > 0) {
                    backgroundImages = `
                        repeating-linear-gradient(0deg, #ddd 0px, #ddd 2px, transparent 2px, transparent ${overlaySize}px),
                        repeating-linear-gradient(90deg, #ddd 0px, #ddd 2px, transparent 2px, transparent ${overlaySize}px),
                    ` + backgroundImages;
                }
                
                contentArea.style.backgroundImage = backgroundImages;
                contentArea.style.backgroundSize = '';
            } else if (templateType === 'dot-grid') {
                const overlaySize = gridSize * overlayMultiplier;
                let backgroundImages = `radial-gradient(circle, #c0c0c0 1.5px, transparent 1.5px)`;
                let backgroundSizes = `${gridSize}px ${gridSize}px`;
                
                if (overlayMultiplier > 0) {
                    backgroundImages = `
                        radial-gradient(circle, #bbb 2.5px, transparent 2.5px),
                    ` + backgroundImages;
                    backgroundSizes = `${overlaySize}px ${overlaySize}px, ${gridSize}px ${gridSize}px`;
                }
                
                contentArea.style.backgroundImage = backgroundImages;
                contentArea.style.backgroundSize = backgroundSizes;
            } else {
                contentArea.style.backgroundImage = '';
                contentArea.style.backgroundSize = '';
            }
            
            if (marginTop > 0 || marginBottom > 0 || marginLeft > 0 || marginRight > 0) {
                marginLines.style.borderTopWidth = marginTop + 'px';
                marginLines.style.borderBottomWidth = marginBottom + 'px';
                marginLines.style.borderLeftWidth = marginLeft + 'px';
                marginLines.style.borderRightWidth = marginRight + 'px';
                marginLines.style.borderStyle = 'solid';
                
                if (deviceTypeSelect.value === 'rm2') {
                    marginLines.style.borderColor = 'rgba(100, 100, 100, 0.4)';
                } else {
                    marginLines.style.borderColor = 'rgba(255, 100, 100, 0.3)';
                }
                
                marginLines.style.display = 'block';
            } else {
                marginLines.style.display = 'none';
            }
            
            if (marginTop >= 15) {
                urlText.style.display = 'block';
            } else {
                urlText.style.display = 'none';
            }
        }
        
        deviceTypeSelect.addEventListener('change', updatePageSizes);
        templateTypeSelect.addEventListener('change', updateTemplate);
        pageSizeSelect.addEventListener('change', () => {
            applyDefaultMargins();
            updateTemplate();
        });
        bindingTypeSelect.addEventListener('change', updateRecommendation);
        platformSelect.addEventListener('change', updateRecommendation);
        marginTopSelect.addEventListener('change', updateTemplate);
        marginBottomSelect.addEventListener('change', updateTemplate);
        marginLeftSelect.addEventListener('change', updateTemplate);
        marginRightSelect.addEventListener('change', updateTemplate);
        gridSizeSelect.addEventListener('change', updateTemplate);
        overlayGridSelect.addEventListener('change', updateTemplate);
        
        // Initialize
        updatePageSizes();
        updateRecommendation();
    </script>
</body>
</html>